openapi: 3.0.3
info:
  title: Easyapp API
  version: 1.0.0
  description: API documentation for easyapp
paths:
  /api/hello/:
    get:
      operationId: api_hello_retrieve
      description: Get a hello world message
      tags:
      - api
      security:
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Message'
          description: ''
  /api/auth/register/:
    post:
      operationId: auth_register
      tags: [auth]
      description: Register a new member
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: Registered
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                required: [message]
        '400':
          description: Validation error
  /api/auth/login/:
    post:
      operationId: auth_login
      tags: [auth]
      description: Login and obtain JWT token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
        '400':
          description: Validation error
  /api/auth/profile/:
    get:
      operationId: auth_profile
      tags: [auth]
      description: Get current member profile
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Member'
  /api/projects/:
    get:
      operationId: project_list
      tags: [projects]
      description: List current member's projects
      security:
        - bearerAuth: []
      responses:
        '200':
          description: A list of projects
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Project'
    post:
      operationId: project_create
      tags: [projects]
      description: Create a project
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProjectCreateRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
  /api/projects/{id}/:
    get:
      operationId: project_retrieve
      tags: [projects]
      description: Retrieve a project by id (owner only)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
    patch:
      operationId: project_update
      tags: [projects]
      description: Update project title
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProjectUpdateRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
    delete:
      operationId: project_delete
      tags: [projects]
      description: Delete a project (owner only)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '204':
          description: Deleted
  /api/projects/{id}/assets/:
    get:
      operationId: project_assets_list
      tags: [assets]
      description: List assets for a project (owner only)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Asset'
    post:
      operationId: project_assets_upload
      tags: [assets]
      description: Upload an asset (owner only). Only 'video/mp4' files up to 50MB are allowed.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
              required: [file]
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Asset'
  /api/projects/{id}/assets/chunked/init/:
    post:
      operationId: project_assets_chunked_init
      tags: [assets]
      description: Initialize a chunked upload session. Only MP4 allowed.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChunkedInitRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChunkedInitResponse'
        '400':
          description: Bad request
        '413':
          description: Payload too large
  /api/projects/{id}/assets/chunked/{upload_id}/:
    post:
      operationId: project_assets_chunked_upload
      tags: [assets]
      description: Upload a file chunk for the given upload session.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
        - in: path
          name: upload_id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                chunk:
                  type: string
                  format: binary
                index:
                  type: integer
              required: [chunk]
      responses:
        '200':
          description: Progress
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChunkedUploadProgress'
        '400':
          description: Bad request
        '404':
          description: Not found
  /api/projects/{id}/assets/chunked/{upload_id}/complete/:
    post:
      operationId: project_assets_chunked_complete
      tags: [assets]
      description: Complete the chunked upload and create an Asset entry.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
        - in: path
          name: upload_id
          required: true
          schema: { type: string, format: uuid }
      responses:
        '201':
          description: Asset created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Asset'
        '400':
          description: Bad request
        '404':
          description: Not found
  /api/projects/{id}/history/:
    get:
      operationId: project_history_list
      tags: [history]
      description: List edit history for a project (owner only)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/EditHistory'
    post:
      operationId: project_history_create
      tags: [history]
      description: Create a history record
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EditHistoryCreateRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EditHistory'
components:
  schemas:
    Message:
      type: object
      properties:
        message:
          type: string
          maxLength: 200
        timestamp:
          type: string
          format: date-time
          readOnly: true
      required:
      - message
      - timestamp
    Member:
      type: object
      properties:
        id:
          type: integer
          readOnly: true
        email:
          type: string
          format: email
        name:
          type: string
        created_at:
          type: string
          format: date-time
          readOnly: true
        updated_at:
          type: string
          format: date-time
          readOnly: true
      required: [id, email, name, created_at, updated_at]
    RegisterRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        name:
          type: string
        password:
          type: string
          format: password
          minLength: 6
      required: [email, password]
    LoginRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          format: password
      required: [email, password]
    TokenResponse:
      type: object
      properties:
        token:
          type: string
        member:
          $ref: '#/components/schemas/Member'
      required: [token, member]
    Project:
      type: object
      properties:
        id:
          type: integer
        owner:
          type: integer
          description: Owner member id
        title:
          type: string
          maxLength: 200
        assets_count:
          type: integer
          description: Number of assets in the project
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required: [id, owner, title, created_at, updated_at]
    ProjectCreateRequest:
      type: object
      properties:
        title:
          type: string
          maxLength: 200
      required: [title]
    ProjectUpdateRequest:
      type: object
      properties:
        title:
          type: string
          maxLength: 200
    Asset:
      type: object
      properties:
        id:
          type: integer
        project:
          type: integer
        original_name:
          type: string
        size:
          type: integer
        mime:
          type: string
          default: video/mp4
        file:
          type: string
          format: uri
          description: URL path relative to the current host (e.g., /media/...)
        created_at:
          type: string
          format: date-time
      required: [id, project, original_name, size, mime, file, created_at]
    ChunkedInitRequest:
      type: object
      properties:
        filename:
          type: string
        size:
          type: integer
        mime:
          type: string
      required: [filename, size]
    ChunkedInitResponse:
      type: object
      properties:
        upload_id:
          type: string
        chunk_size:
          type: integer
      required: [upload_id, chunk_size]
    ChunkedUploadProgress:
      type: object
      properties:
        received:
          type: integer
        done:
          type: boolean
      required: [received, done]
    EditHistory:
      type: object
      properties:
        id:
          type: integer
        project:
          type: integer
        action:
          type: string
          enum: [trim, merge, add_text, crop]
        params:
          type: object
        created_at:
          type: string
          format: date-time
      required: [id, project, action, params, created_at]
    EditHistoryCreateRequest:
      type: object
      properties:
        action:
          type: string
          enum: [trim, merge, add_text, crop]
        params:
          type: object
      required: [action]
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
